function getTotal(){var e="https://api.eallion.com/memos/api/memo/stats?creatorId=101";fetch(e).then(e=>e.json()).then(e=>{if(e.data){var t=e.data.length,a=document.getElementById("memosCount");a.innerHTML=t}}).catch(e=>{})}function getFirstList(){var e=localUrl+"?t="+Date.parse(new Date);fetch(e).then(e=>e.json()).then(e=>{updateHTMl(e.data);var t=e.data.length;t<limit?document.querySelector("button.button-load").remove():(page++,offset=limit*(page-1),getNextList())})}function getNextList(){var e=remoteUrl+"&limit="+limit+"&offset="+offset;fetch(e).then(e=>e.json()).then(e=>{nextDom=e.data,nextLength=nextDom.length,page++,offset=limit*(page-1),nextLength<1&&document.querySelector("button.button-load").remove()})}function updateHTMl(e){var t="",a="";const o=/#([^\s#]+)/,i=/<a\shref="https:\/\/music\.163\.com\/.*id=([0-9]+)".*?>.*<\/a>/g,r=/<a\shref="https\:\/\/y\.qq\.com\/.*(\/[0-9a-zA-Z]+)(\.html)?".*?>.*?<\/a>/g,s=/<a\shref="https:\/\/open\.spotify\.com\/(track|album)\/([\s\S]+)".*?>.*<\/a>/g;marked.setOptions({breaks:!0,smartypants:!0,langPrefix:"language-",highlight:function(e,t){const a=hljs.getLanguage(t)?t:"plaintext";return hljs.highlight.toString(e,{language:a}).value}});const n=new marked.Renderer,l=n.link;n.link=((e,t,a)=>{const o=e.startsWith(`${location.protocol}//${location.hostname}`),i=l.call(n,e,t,a);return o?i:i.replace(/^<a /,'<a target="_blank" rel="noreferrer noopener nofollow" ')}),marked.use({renderer:n});for(var m=0;m<e.length;m++){var c=e[m].id,d=e[m].content.replace(o,"<span class='tag-span'><a>$1</a></span> ");if(d=marked.parse(d).replace(i,"<meting-js auto='https://music.163.com/#/song?id=$1'></meting-js>").replace(r,"<meting-js auto='https://y.qq.com/n/yqq/song$1.html'></meting-js>").replace(s,"<div class='spotify-wrapper'><iframe style='border-radius:12px' src='https://open.spotify.com/embed/$1/$2?utm_source=generator&theme=0' width='100%' frameBorder='0' allowfullscreen='' allow='autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture' loading='lazy'></iframe></div>"),e[m].resourceList&&e[m].resourceList.length>0){for(var p=e[m].resourceList,g="",h="",v=0,u=0;u<p.length;u++){var f=p[u].type.slice(0,5);"image"==f&&(g+='<img loading="lazy" src="'+memos+"o/r/"+p[u].id+"/"+p[u].filename+'"/>',v+=1),"image"!==f&&(h+='<a target="_blank" rel="noreferrer" href="'+memos+"o/r/"+p[u].id+"/"+p[u].filename+'">'+p[u].filename+"</a>")}if(g){var b="";if(1!==v)b="grid grid-"+v;d+='<div class="resimg '+b+'">'+g+"</div>"}h&&(d+='<p class="datasource">'+h+"</p>")}t+='<li id="'+c+'" class="timeline"><div class="talks__content"><div class="talks__text"><div class="talks__userinfo"><div>Charles Chin</div><div><svg viewBox="0 0 24 24" aria-label="认证账号" class="talks__verify"><g><path d="M22.5 12.5c0-1.58-.875-2.95-2.148-3.6.154-.435.238-.905.238-1.4 0-2.21-1.71-3.998-3.818-3.998-.47 0-.92.084-1.336.25C14.818 2.415 13.51 1.5 12 1.5s-2.816.917-3.437 2.25c-.415-.165-.866-.25-1.336-.25-2.11 0-3.818 1.79-3.818 4 0 .494.083.964.237 1.4-1.272.65-2.147 2.018-2.147 3.6 0 1.495.782 2.798 1.942 3.486-.02.17-.032.34-.032.514 0 2.21 1.708 4 3.818 4 .47 0 .92-.086 1.335-.25.62 1.334 1.926 2.25 3.437 2.25 1.512 0 2.818-.916 3.437-2.25.415.163.865.248 1.336.248 2.11 0 3.818-1.79 3.818-4 0-.174-.012-.344-.033-.513 1.158-.687 1.943-1.99 1.943-3.484zm-6.616-3.334l-4.334 6.5c-.145.217-.382.334-.625.334-.143 0-.288-.04-.416-.126l-.115-.094-2.415-2.415c-.293-.293-.293-.768 0-1.06s.768-.294 1.06 0l1.77 1.767 3.825-5.74c.23-.345.696-.436 1.04-.207.346.23.44.696.21 1.04z"></path></g></svg></div><div class="talks__id">@eallion · </div><small class="talks__date"><a href="https://memos.eallion.com/m/'+c+'" target="_blank">'+moment(1e3*e[m].createdTs).twitterLong()+"</a></small></div><p>"+d+"</p><div class='talks_comments'><a onclick=\"loadArtalk('"+c+"')\"><i class='fas fa-comment-dots fa-fw'></i><span id='btn_memo_"+c+"'>评论</span> (<span id='ArtalkCount' data-page-key='/m/"+c+"'>0</span>)</a></div><div id='memo_"+c+"' class='artalk hidden'></div></div></li>"}var k='<ul class="talks">',y="</ul>";a=k+t+y,memoDom.insertAdjacentHTML("beforeend",a),fetchDB(),hljs.initHighlighting.called=!1,hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll(),document.querySelector("button.button-load").textContent="加载更多"}function loadArtalk(e){const t=document.getElementById("memo_"+e),a=document.getElementById("btn_memo_"+e);if(t.classList.contains("hidden")){t.classList.remove("hidden"),a.innerHTML='收起评论<i class="fas fa-level-up-alt"></i>';const i=new Artalk({el:"#memo_"+e,pageKey:"/m/"+e,pageTitle:"",server:"https://api.eallion.com/artalk/",site:"memos",darkMode:"auto"});function o(){const e=document.body.getAttribute("theme");i.setDarkMode("dark"===e)}o(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{o()})}else t.classList.add("hidden"),a.innerHTML="评论"}function fetchDB(){var e="https://api.eallion.com/douban/",t=document.querySelectorAll(".timeline a[href*='douban.com/subject/']:not([rel='noreferrer'])")||"";if(t)for(var a=0;a<t.length;a++){_this=t[a];var o=_this.href,i=/^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/,r=o.replace(i,"$1"),s=o.replace(i,"$2").toString();if("movie"==r){var n="movie"+s,l=e+"movies/"+s;null==localStorage.getItem(n)||"undefined"==localStorage.getItem(n)?fetch(l).then(e=>e.json()).then(e=>{let t="movies"+e.sid,a="https://movie.douban.com/subject/"+e.sid+"/";localStorage.setItem(t,JSON.stringify(e)),movieShow(a,t)}):movieShow(o,n)}else if("book"==r){n="book"+s,l=e+"v2/book/id/"+s;null==localStorage.getItem(n)||"undefined"==localStorage.getItem(n)?fetch(l).then(e=>e.json()).then(e=>{let t="book"+e.id,a="https://book.douban.com/subject/"+e.id+"/";localStorage.setItem(t,JSON.stringify(e)),bookShow(a,t)}):bookShow(o,n)}}}function movieShow(e,t){var a=localStorage.getItem(t),o=JSON.parse(a),i=Math.ceil(o.rating),r="<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><h4 class='post-preview--title'><a target='_blank' rel='noreferrer' href='"+e+"'>《"+o.name+"》</a></h4><div class='rating'><div class='rating-star allstar"+i+"'></div><div class='rating-average'>"+o.rating+"</div></div><time class='post-preview--date'>导演："+o.director+" / 类型："+o.genre+" / "+o.year+"</time><section class='post-preview--excerpt'>"+o.intro.replace(/\s*/g,"")+"</section></div></div><img referrer-policy='no-referrer' loading='lazy' class='post-preview--image' src="+o.img+"></div>",s=document.createElement("div"),n=".timeline a[href='"+e+"']",l=document.querySelector(n);l.parentNode.replaceChild(s,l),s.innerHTML=r}function bookShow(e,t){var a=localStorage.getItem(t),o=JSON.parse(a),i=Math.ceil(o.rating.average),r="<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><h4 class='post-preview--title'><a target='_blank' rel='noreferrer' href='"+e+"'>《"+o.title+"》</a></h4><div class='rating'><div class='rating-star allstar"+i+"'></div><div class='rating-average'>"+o.rating.average+"</div></div><time class='post-preview--date'>作者："+o.author+" </time><section class='post-preview--excerpt'>"+o.summary.replace(/\s*/g,"")+"</section></div></div><img referrer-policy='no-referrer' loading='lazy' class='post-preview--image' src="+o.images.medium+"></div>",s=document.createElement("div"),n=".timeline a[href='"+e+"']",l=document.querySelector(n);l.parentNode.replaceChild(s,l),s.innerHTML=r}window.onload=getTotal();var memo={host:"https://demo.usememos.com/",limit:"10",creatorId:"101",domId:"#memos"};if(void 0!==memos)for(var key in memos)memos[key]&&(memo[key]=memos[key]);var limit=memo.limit,memos=memo.host,localUrl="https://api.eallion.com/memos/memos.json",remoteUrl="https://api.eallion.com/memos/api/memo?creatorId="+memo.creatorId+"&rowStatus=NORMAL",page=1,offset=10,nextLength=0,nextDom="",memoDom=document.querySelector(memo.domId),load='<button class="load-btn button-load">努力加载中……</button>';if(memoDom){memoDom.insertAdjacentHTML("afterend",load),getFirstList();var btn=document.querySelector("button.button-load");btn.addEventListener("click",function(){btn.textContent="努力加载中……",updateHTMl(nextDom),nextLength<limit?document.querySelector("button.button-load").remove():getNextList()})}document.addEventListener("DOMContentLoaded",()=>{let e=6;var t="https://api.eallion.com/memos/",a=t+"api/memo/all?rowStatus=NORMAL&tag=相册&limit="+e;let o=0;fetch(a).then(e=>e.json()).then(t=>{for(var a="",i="",r=t.data,s=0;s<r.length;s++){var n=r[s].content.replace("#相册 ",""),l=r[s].id,m=n.match(/\!\[(.*?)\s*(.*?)\]\((.*?)\)/g);m&&m.forEach(t=>{if(o<e){o++;let e,i,r=t.replace(/!\[.*?\]\((.*?)\)/g,"$1"),s=t.replace(/!\[(.*?)\]\(.*?\)/g,"$1");-1!=s.indexOf(" ")?(e=s.split(" ")[0],i=s.split(" ")[1]):i=s,a+=`<div class="memos-photo"><img class="photo-img" loading='lazy' decoding="async" src="${r}"></a>`,i&&(a+=`<a href="https://memos.eallion.com/m/${l}" target="_blank" rel="noreferrer noopener nofollow"><span class="photo-title">${i}</span></a>`),e&&(a+=`<span class="photo-time">${e}</span>`),a+="</div>"}})}var c=document.querySelector("#album"),d='<div class="memos-photo-wrapper">',p="</div>";i=d+a+p,c.innerHTML=i,window.Lately&&Lately.init({target:".photo-time"})})}),document.addEventListener("DOMContentLoaded",()=>{pangu.autoSpacingPage()});