{{- define "main" }} {{- $isNewsletter := eq .Type "newsletter" }}

<article class="post-single">
  <header class="post-header">
    {{ partial "breadcrumbs.html" . }} {{- if $isNewsletter -}} {{- partial
    "newsletter_brand.html" . }} {{- end -}}

    <a href="/">
      <div class="return-back">
        <div class="back-icon">←</div>
        <div class="back-word">主页</div>
        <div class="article-time">
          {{- if not .Date.IsZero -}}
          <span class="meta-time">
            <span
              >{{ .Date | time.Format (default "January 2, 2006"
              site.Params.DateFormat) }}</span
            ></span
          >
          {{- end }}
        </div>
      </div>
    </a>

    <h1 class="post-title">
      {{- if $isNewsletter -}} {{- replace .Title (.Param "titlePrefix") (.Param
      "titlePrefixReplace") -}} {{- else -}} {{- .Title -}} {{- end -}} {{- if
      .Draft -}}<sup><span class="entry-isdraft">&nbsp;&nbsp;[draft]</span></sup
      >{{- end -}}
    </h1>
    {{- if .Description }}
    <div class="post-description">{{- .Description -}}</div>
    {{- end }} {{- if not (.Param "hideMeta") }}
    <div class="post-meta">
      {{- partial "post_meta.html" . -}} {{/* TODO move to footer */}} {{/*
      partial "edit_post.html" . */}} {{/* partial "post_canonical.html" . */}}
    </div>
    {{- end }}
  </header>
  {{- $isHidden := .Params.cover.hidden | default
  site.Params.cover.hiddenInSingle | default site.Params.cover.hidden }} {{-
  partial "cover.html" (dict "cxt" . "IsHome" false "isHidden" $isHidden) }} {{-
  if (.Param "ShowToc") }} {{- partial "toc.html" . }} {{- end }} {{- if
  .Content }}
  <div class="post-content slide-enter-content">
    <!-- 下面显示contentai的内容 -->
    {{ if .Params.ai }}
    <div class="contentai">
      <div class="contentai-head">
        <div class="contentai-title">
          <svg class="iconpark-icon">
            <use href="#icon-contentai"></use>
          </svg>
          AI 摘要
        </div>
        <div class="contentai-span">基于 ChatGPT 3.5</div>
      </div>
      <!-- 这里给div增加了一个id "typedText"，并将内容隐藏在一个javascript变量中 -->
      <div class="contentai-ai">
        <span id="typedText"></span>
        <span class="typed-cursor typed-cursor--blink">|</span>
      </div>
      <script>
        var contentaiText = {{ .Params.ai | safeHTML }};
      </script>
    </div>
    {{ end }}
    <!-- 上面显示contentai的内容 -->

    {{- if not (.Param "disableAnchoredHeadings") }} {{- partial
    "anchored_headings.html" .Content -}} {{- else }}{{ .Content }}{{ end }}
  </div>
  {{- end }}

  <footer class="post-footer">
    <!-- 添加打赏功能开始 -->
    <div
      style="
        padding: 10px 0;
        margin: 20px auto;
        width: 100%;
        font-size: 16px;
        text-align: center;
      "
    >
      <button
        id="rewardButton"
        disable="enable"
        onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}"
      >
        <span class="button-text">
          <svg class="iconpark-icon"><use href="#ketou"></use></svg> 打赏</span
        >
      </button>
      <span
        style="
          font-size: 13px;
          margin-top: 4px;
          display: inline-block;
          align-items: center;
          color: var(--tertiary);
        "
        >展示「金主」的页面筹划中……</span
      >
      <div id="QR" style="display: none">
        <div id="wechat" style="display: inline-block">
          <a class="fancybox" rel="group">
            <img
              id="wechat_qr"
              src="https://images.wananaiko.com/2023/06/IMG_5127.JPG"
              alt="WeChat Pay"
              data-action="zoom"
          /></a>
          <p>微信打赏</p>
        </div>
        <!-- <div id="alipay" style="display: inline-block">
          <a class="fancybox" rel="group">
            <img
              id="alipay_qr"
              src="https://images.wananaiko.com/2023/06/IMG_5128.JPG"
              alt="Alipay"
          /></a>
          <p>支付宝打赏</p>
        </div> -->
      </div>
    </div>

    <!-- 添加打赏功能结束 -->

    {{- if (.Param "socialLinks") }} {{- partial "social_links.html" . }} {{-
    end }} {{- if (.Param "ShowPostNavLinks") }} {{- partial
    "post_nav_links.html" . }} {{- end }} {{- if $isNewsletter }}
    <div class="newsletter-sub">
      <div class="notice">
        感谢你能读到这里，如果觉得有趣的话，欢迎在下方输入邮箱进行订阅。
      </div>
      {{- partial "newsletter_sub_form.html"}}
    </div>
    {{- end }}
  </footer>

  <!--增加 外部Link 预览效果-->
  <!-- <script src="https://js.linkz.ai/?key=641a952e5e858e300b0deeb1"></script> -->

  {{ if (and .Site.Params.remark42SiteID .Params.comments) }}
  <div id="remark42"></div>
  {{ end }} {{- if not (.Param "noComments") }} {{- partial "comments.html" . }}
  {{- end }}
</article>

<script src="/js/highlight-title.js"></script>

<!-- JavaScript 打字动画库 -->
<script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
<script>
  var typed = new Typed("#typedText", {
    strings: [contentaiText],
    typeSpeed: 30,
    cursorChar: "", // 关闭默认的光标
  });
</script>

{{- end }}{{/* end main */}}
