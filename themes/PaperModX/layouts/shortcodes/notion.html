{{ define "main" }}
<div id="notion-content"></div>
<script>
   const databaseID = "{{ .Params.databaseID }}";
   const apiToken = "{{ .Params.apiToken }}";
   fetchNotionContent(databaseID, apiToken);

   async function fetchNotionContent(databaseID, apiToken) {
      const response = await fetch("https://api.notion.com/v1/databases/" + databaseID + "/query", {
         method: "POST",
         headers: {
            "Authorization": "Bearer " + apiToken,
            "Content-Type": "application/json",
            "Notion-Version": "2022-08-16"
         },
         body: JSON.stringify({ filter: {} }) // Optional: Add filter to query
      });

      if (response.ok) {
         const data = await response.json();
         const results = data.results;
         displayNotionContent(results);
      } else {
         console.error("Error fetching Notion content:", response.status);
      }
   }

   function displayNotionContent(results) {
      const container = document.getElementById("notion-content");
      results.forEach(result => {
         const tweet = result.properties.Tweet.title[0]?.text.content || "";
         const author = result.properties.Author.rich_text[0]?.text.content || "";
         const link = result.properties.Link.url || "";
         const tags = result.properties.Tags.multi_select.map(tag => tag.name).join(", ");

         container.innerHTML += `
            <div>
               <h2>${tweet}</h2>
               <p>${author}</p>
               <a href="${link}" target="_blank">${link}</a>
               <p>Tags: ${tags}</p>
            </div>`;
      });
   }
</script>
{{ end }}