{{ $token := "d7e078a0-3f49-4419-981a-8695c399b0d8" }}
{{ $collection := "34199304" }}
{{ $apiUrl := printf "https://api.raindrop.io/rest/v1/raindrops/%s" $collection }}
{{ $json := getJSON $apiUrl "?access_token=" $token "&perpage=50&sort=-created" }}

<script
  type="text/javascript"
  src="https://fastly.jsdelivr.net/gh/Tokinx/Lately/lately.min.js"
></script>

<link rel="stylesheet" href="https://unpkg.com/pyloncss@latest/css/pylon.css"/>

<style>
  .inline-links {
    display: none;
}

  .mk-raindrop-bookmarks {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    margin: 0 auto;
    box-shadow: none;
    transition: none;
    overflow-x: hidden;
    max-width: 100%;
  }

  .mk-raindrop-bookmark {
    width: 100%;
    margin: 0 auto;
    border-top: var(--border-top);
    cursor: pointer;
  }

  .mk-raindrop-bookmark:hover{
    text-decoration: none;
    box-shadow: none;
    border-top: 0.5px solid var(--code-bg);
    --bookmark-list-opacity: 1;
    background-color: rgb(250 250 250/var(--bookmark-list-opacity));
    border-radius: var(--radius);
  }

  .dark .mk-raindrop-bookmark:hover {
    text-decoration: none;
    box-shadow: none;
    border-top: 0.5px solid var(--code-bg);
    border-radius: var(--radius);
    --bookmark-list-opacity: .1;
    background-color: rgb(0 0 0/var(--bookmark-list-opacity));
}

  .mk-raindrop-bookmark:hover + .mk-raindrop-bookmark {
    border-top: 0.5px solid var(--code-bg);
  }

  .mk-raindrop-bookmark a {
    text-decoration: none;
    color: inherit;
    display: block;
    box-shadow: none;
    padding: 1rem .5rem;
    line-height: 1.2;
  }

  .mk-raindrop-bookmark a:hover{
    text-decoration: none;
    box-shadow: none;
    padding: 1rem .5rem;
  }

  .mk-title-wrapper {
    display: inline-flex;
    align-items: flex-start;
    position: relative;
    justify-content: flex-start;
  }

  .mk-title {
    font-size: 16px;
    font-weight: 500;
    background-repeat: no-repeat;
    background-position: left center;
    background-size: 16px;
    line-height: 1.5rem;
    color: var(--content);
    transition: .5s;
    margin-left: 26px;
  }

  .mk-raindrop-bookmark:hover .mk-title {
    color: var(--content);
    box-shadow: 0 1px 0 var(--content);
  }

  .mk-avatar {
    width: 16px;
    height: 16px;
    background-size: cover;
    background-position: center;
    margin-right: 10px;
    border-radius: 2px;
    margin-top: 0.3rem;
    position: absolute;
  }

  .mk-excerpt {
    font-size: 14px;
    line-height: 1.6;
    color: var(--secondary);
    overflow: hidden;
    text-overflow: ellipsis;
    padding-left: 26px;
    margin: 0.2rem 0 0.3rem 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

  .mk-raindrop-tags {
    display: flex;
    flex-wrap: wrap;
    padding: 0;
    margin: 0.4rem 0 0 0;
    padding-left: 26px;
    align-items: center;
    gap: 0.5rem;
  }

  .mk-tag {
    display: inline-block;
    color: var(--secondary);
    font-size: 12px;
    white-space: nowrap;
    line-height: 1.4rem;
}

  .mk-divider {
    /* width: 100%;
    background-color: var(--tertiary-bg);
    border-bottom: 0.5px solid var(--tertiary-bg);
    opacity: .65; */
    display: none;
  }

  .mk-svg {
    margin-left: 0;
    opacity: 0;
    position: absolute;
    right: -20px;
    transform: translateX(20px);
    transition: all .2s ease;
    display: flex;
    justify-content: center;
  }

  .mk-raindrop-bookmark:hover .mk-svg {
    opacity: 1;
    transform: translateX(0);
  }

  .mk-tab {
    display: flex;
    flex-wrap: wrap;
    gap: 0.6rem;
    padding-bottom: 1.5rem;
  }

  .mk-tab-tag {
    display: inline-block;
    color: var(--secondary);
    background: linear-gradient(180deg, rgba(223, 225, 231, 0) 0%, rgba(223, 225, 231, 0.05) 100%), var(--entry);
    box-shadow: 0px 1px 2px rgba(42, 59, 81, 0.12), 0px 0px 0px 1px rgba(18, 55, 105, 0.08);
    border-radius: 6px;
    padding: 0.05rem 0.5rem;
    font-size: 13px;
    white-space: nowrap;
    line-height: 1.4rem;
    cursor: pointer;
  }

  .mk-tab-tag.mk-tab-tag-active:hover {
    color: rgba(255, 255, 255, 0.9);
    background-color: var(--link-hover-color);
}

.dark .mk-tab-tag-active {
box-shadow: none;
}

  .mk-tab-tag:hover {
    color: var(--secondary);
    background-color: var(--code-bg);
  }

  .mk-tab-tag-active { 
    color: rgba(255, 255, 255, 0.9);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.16) 0%, rgba(255, 255, 255, 0) 100%), #009999;
    box-shadow: 0px 1px 2px rgba(0, 80, 80, 0.4), 0px 0px 0px 1px rgba(0, 122, 122, 0.76);
    border-radius: 6px;
  }

  .mk-update-time {
    margin-left: auto;
    opacity: .7;
    color: var(--tertiary);
    font-size: 12px;
    white-space: nowrap;
    line-height: 1.4rem;
  }

  .mk-tag.mk-update-time {
    background-color: unset;
  }

  span.mk-important-description {
    margin-left: auto;
    color: var(--link-hover-color);
    font-size: 12px;
    white-space: nowrap;
    line-height: 1.4rem;
    margin-right: 0.5rem;
}

.mk-important {
    display: flex;
    align-items: center;
    gap: 2px;
}
.mk-raindrop-bookmark.important {
    background-color: rgb(198 239 239 / 25%);
}

.mk-raindrop-bookmark.important:hover {
    background-color: rgb(198 239 239 / 40%);
}

.dark .mk-raindrop-bookmark.important {
    background-color: rgb(26 55 55 / 30%);
}

.dark .mk-raindrop-bookmark.important:hover {
    background-color: rgba(30, 65, 65, 0.3);
}

mark{
    all:unset;
    margin: 18px;
    border-radius: 0.8em 0.3em;
    background: 0 0;
    background-image: linear-gradient( to right,rgba(255,225,0,.1),rgba(255,225,0,.6) 4%,rgba(255,225,0,.3) );
    -webkit-box-decoration-break: clone;
    box-decoration-break: clone;
    padding: 0 0.5rem;
    font-size: 14px;
    line-height: 1.6 !important;
}

.dark mark{
  color: var(--theme);
}

</style>

<!-- Base on raindrop.io's API filters, Add a Tab switch Group to view different tags,each tag is displayed only once in the this Tab switch. -->
<div class="mk-tab">
  <div class="mk-tab-tag" onclick="showAll()">All</div>

<!-- 跳转到Raindrop官网 -->
<!-- <div class="mk-tab-tag">
  <a href="https://raindrop.io/7144206/share-on-hugo-34199304" target="_blank" rel="noreferrer" style="all:unset;display:flex;align-items:center;">
    <svg class="raindrop" width="20" height="20" margin-right="4px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M17.2 9.79839C17.2 5.82247 13.9767 2.59843 10 2.59843C6.02327 2.59843 2.8 5.82247 2.8 9.79839C2.8 13.7752 6.02327 16.9984 10 16.9984C13.9767 16.9984 17.2 13.7752 17.2 9.79839Z" stroke="var(--secondary)" stroke-linecap="round" stroke-linejoin="round"/>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M7.49687 12.3018L8.69016 8.48936L12.5026 7.2961L11.3094 11.1086L7.49687 12.3018Z" stroke="var(--secondary)" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    Magic
  </a>
</div> -->

  {{ range $i, $item := index $json "items" }}
  {{ range $j, $tag := $item.tags }}
  <div class="mk-tab-tag" onclick="showTag('{{ $tag }}')">{{ $tag }}</div>
  {{ end }}
  {{ end }}
  <div class="mk-divider"></div>
</div>

<script>
  // 过滤掉上面mk-raindrop-tags"中重复的tag
  var tags = document.getElementsByClassName("mk-tab-tag");
  var tagList = [];
  for (var i = 0; i < tags.length; i++) {
    if (tagList.indexOf(tags[i].innerHTML) == -1) {
      tagList.push(tags[i].innerHTML);
    } else {
      tags[i].style.display = "none";
    }
  }

  function showAll() { var bookmarks = document.getElementsByClassName("mk-raindrop-bookmark"); for (var i = 0; i < bookmarks.length; i++) { bookmarks[i].style.display = "block"; } var tags = document.getElementsByClassName("mk-tab-tag"); for (var i = 0; i < tags.length; i++) { tags[i].classList.remove("mk-tab-tag-active"); } document.querySelector('.mk-tab-tag').classList.add('mk-tab-tag-active'); }

  function showTag(tag) { var bookmarks = document.getElementsByClassName("mk-raindrop-bookmark"); for (var i = 0; i < bookmarks.length; i++) { if (bookmarks[i].querySelectorAll('.mk-tag').length > 0) { var found = false; var bookmarkTags = bookmarks[i].querySelectorAll('.mk-tag'); for (var j = 0; j < bookmarkTags.length; j++) { if (bookmarkTags[j].innerHTML == tag) { found = true; break; } } if (found) { bookmarks[i].style.display = "block"; } else { bookmarks[i].style.display = "none"; } } else { bookmarks[i].style.display = "none"; } } var tags = document.getElementsByClassName("mk-tab-tag"); for (var i = 0; i < tags.length; i++) { if (tags[i].innerHTML == tag) { tags[i].classList.add("mk-tab-tag-active"); } else { tags[i].classList.remove("mk-tab-tag-active"); } } }

  document.querySelector('.mk-tab-tag:first-child').classList.add('mk-tab-tag-active');
  
</script>


<div class="mk-raindrop-bookmarks">
  
  {{ range $i, $item := index $json "items" }} {{ $domain := index (findRE
  "[^.]+\\.[^.]+$" (index (findRE "//[^/]+" $item.link) 0)) 0 }}
  <div class="mk-raindrop-bookmark">
    <a href="{{ $item.link }}" target="_blank" rel="noopener noreferrer">
      <div class="mk-title-wrapper">
        <div
          class="mk-avatar"
          style="background-image: url('https://unavatar.io/{{ trim $domain "/" }}'); background-size: 16px 16px;"
        ></div>
        <div class="mk-title">
          {{ $item.title }}
        </div>
        <div class="mk-svg">
          →
        </div>
      </div>
      {{ with $item.excerpt }}
      <div class="mk-excerpt">{{ . }}</div>
      {{ end }}

      <!-- 显示Raindrop API中全部的highlights,并将数据放在<mark></mark>中. -->
      {{ range $highlight := $item.highlights }}
      <mark>{{ $highlight.text }}</mark>
      {{ end }}

      {{ with $item.tags }}
      <div class="mk-raindrop-tags">
        {{ range . }}
        <div class="mk-tag">{{ . }}</div>
        <divider></divider>
        {{ end }}
        <div class="mk-tag mk-update-time">{{ $item.lastUpdate }}</div>
        <spacer></spacer>
        <!-- 增加一个div class="mk-important",从Raindrop API中获取important的值,如果是Boolean增显示<span>favorite</span> -->

        <div class="mk-important">
        {{ if eq $item.important true }}
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M16.6663 11.3333C15.6601 14.5 12.8534 16.6667 9.58301 16.6667C6.22871 16.75 3.33301 14.0833 3.33301 10.75C3.33301 10.3333 3.33301 10 3.41687 9.58333L5.09401 10.0833C4.75858 12.75 6.89957 15.0833 9.58301 15C12.1826 14.9167 14.4022 13.1667 15.1569 10.75L16.6663 11.3333ZM7.27431 9.16667C8.19674 9.16667 9.28689 7.66667 9.62232 5.83333C10.0416 4 9.62232 2.5 8.69988 2.5C7.77745 2.5 6.77116 4 6.35188 5.83333C5.93259 7.66667 6.35188 9.16667 7.27431 9.16667ZM12.725 9.58333C13.6475 9.58333 14.7376 8.08333 15.1569 6.25C15.5762 4.41667 15.1569 2.91667 14.2345 2.91667C13.312 2.91667 12.2219 4.41667 11.8026 6.25C11.3833 8.08333 11.8026 9.58333 12.725 9.58333Z" fill="var(--link-hover-color)"/>
</svg>

        <span class="mk-important-description">很赞</span>
        {{ end }}
        {{ if eq $item.important false }}
        <div></div>
        {{ end }}
        </div>
        
      </div>        

      {{ end }}
    </a>
      {{ if lt $i (sub (len (index $json "items")) 1) }}
  <div class="mk-divider"></div>
  </div>
  {{ end }} {{ end }}
</div>

<script>
  // 使用JavaScript判断,如果mk-raindrop-bookmark里存在mk-important-description元素,则mk-raindrop-bookmark的background-color修改为var(--link-background-color);
    const bookmarks = document.querySelectorAll('.mk-raindrop-bookmark');
  bookmarks.forEach(bookmark => {
    const important = bookmark.querySelector('.mk-important-description');
    if (important) {
      bookmark.classList.add('important');
    }
  });
</script>

<!-- 先将lastUpdate的时间格式化,再显示为相对时间,参考lately.mini.js -->
<script>
        var lastUpdate = document.getElementsByClassName("mk-update-time");
        for (var i = 0; i < lastUpdate.length; i++) {
          var time = lastUpdate[i].innerHTML;
          var date = new Date(time);
          var now = new Date();
          var diff = now.getTime() - date.getTime();
          var days = Math.floor(diff / (24 * 3600 * 1000));
          var leave1 = diff % (24 * 3600 * 1000);
          var hours = Math.floor(leave1 / (3600 * 1000));
          var leave2 = leave1 % (3600 * 1000);
          var minutes = Math.floor(leave2 / (60 * 1000));
          var leave3 = leave2 % (60 * 1000);
          var seconds = Math.round(leave3 / 1000);
          if (days > 0) {
            lastUpdate[i].innerHTML = days + " 天前";
          } else if (hours > 0) {
            lastUpdate[i].innerHTML = hours + " 小时前";
          } else if (minutes > 0) {
            lastUpdate[i].innerHTML = minutes + " 分钟前";
          } else if (seconds > 0) {
            lastUpdate[i].innerHTML = seconds + " 秒前";
          }
          // 增加月前和年前的定义
          var months = Math.floor(days / 30);
          var years = Math.floor(days / 365);
          if (months > 0) {
            lastUpdate[i].innerHTML = months + " 月前";
          } else if (years > 0) {
            lastUpdate[i].innerHTML = years + " 年前";
          }
        }
</script>