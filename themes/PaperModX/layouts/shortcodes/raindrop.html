{{ $token := "d7e078a0-3f49-4419-981a-8695c399b0d8" }}
{{ $collection := "34199304" }}
{{ $apiUrl := printf "https://api.raindrop.io/rest/v1/raindrops/%s" $collection }}
{{ $json := getJSON $apiUrl "?access_token=" $token "&perpage=50&sort=-created" }}

<script
  type="text/javascript"
  src="https://fastly.jsdelivr.net/gh/Tokinx/Lately/lately.min.js"
></script>

<link rel="stylesheet" href="https://unpkg.com/pyloncss@latest/css/pylon.css"/>

<style>
  .inline-links {
    display: none;
}

  .mk-raindrop-bookmarks {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    margin: 0 auto;
    box-shadow: none;
    transition: none;
    overflow-x: hidden;
    max-width: 100%;
  }

  .mk-raindrop-bookmark {
    width: 100%;
    margin: 0 0 1.2rem 0;
  }

  .mk-raindrop-bookmark:hover{
    text-decoration: none;
    box-shadow: none;
  }

  .mk-raindrop-bookmark a {
    text-decoration: none;
    color: inherit;
    display: block;
    box-shadow: none;
  }

  .mk-raindrop-bookmark a:hover{
    text-decoration: none;
    box-shadow: none;
  }

  .mk-title-wrapper {
    display: inline-flex;
    align-items: center;
    position: relative;
  }

  .mk-title {
    font-size: 16px;
    font-weight: 500;
    background-repeat: no-repeat;
    background-position: left center;
    background-size: 16px;
    line-height: 1.5rem;
    color: var(--content);
    transition: .5s;
  }

  .mk-raindrop-bookmark:hover .mk-title {
    color: var(--content);
    box-shadow: 0 1px 0 var(--content);
  }

  .mk-avatar {
    width: 16px;
    height: 16px;
    background-size: cover;
    background-position: center;
    margin-right: 10px;
    border-radius: 2px;
  }

  .mk-excerpt {
    font-size: 14px;
    line-height: 1.6;
    color: var(--secondary);
    overflow: hidden;
    text-overflow: ellipsis;
    padding-left: 26px;
    margin: 0.1rem 0 0.4rem 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

  .mk-raindrop-tags {
    display: flex;
    flex-wrap: wrap;
    padding: 0;
    margin: 0.65rem 0 0.2rem 0;
    padding-left: 26px;
    align-items: center;
    gap: 0.5rem;
  }

  .mk-tag {
    display: inline-block;
    color: var(--tertiary);
    background-color: var(--code-bg);
    border-radius: 3px;
    padding: 0rem 0.5rem;
    font-size: 12px;
    white-space: nowrap;
    line-height: 1.4rem;
}

  .mk-divider {
    width: 100%;
    background-color: var(--tertiary-bg);
    border-bottom: 0.5px solid var(--tertiary-bg); 
    margin-top: 1rem;
    opacity: .65;
  }

  .mk-svg {
    margin-left: 0;
    opacity: 0;
    position: absolute;
    right: -20px;
    transform: translateX(20px);
    transition: all .2s ease;
    display: flex;
    justify-content: center;
  }

  .mk-raindrop-bookmark:hover .mk-svg {
    opacity: 1;
    transform: translateX(0);
  }

  .mk-tab {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding-bottom: 1.5rem;
  }

  .mk-tab-tag {
    display: inline-block;
    color: var(--secondary);
    background-color: var(--code-bg);
    border-radius: 3px;
    padding: 0.05rem 0.5rem;
    font-size: 13px;
    white-space: nowrap;
    line-height: 1.4rem;
    cursor: pointer;
  }

  .mk-tab-tag.mk-tab-tag-active:hover {
    background-color: var(--link-hover-color);
    color: var(--blur-bg);
}
  .mk-tab-tag:hover {
    color: var(--secondary);
    background-color: var(--border);
  }

  .mk-tab-tag-active { 
    color: var(--blur-bg);
    background-color: var(--link-hover-color); 
  }

  .mk-update-time {
    margin-left: auto;
    opacity: .65;
    color: var(--tertiary);
    font-size: 12px;
    white-space: nowrap;
    line-height: 1.4rem;
  }

  .mk-tag.mk-update-time {
    background-color: unset;
  }

  span.mk-important-description {
    margin-left: auto;
    color: var(--link-hover-color);
    font-size: 12px;
    white-space: nowrap;
    line-height: 1.4rem;
}

.mk-important {
    display: flex;
    align-items: center;
    gap: 2px;
}

  @media (max-width: 768px) {
  .mk-title-wrapper {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
  .mk-avatar {
    align-self: flex-start;
    margin-top: 0;
    margin-bottom: -21px; /* 可根据需要调整 */
  }
  .mk-title{
    margin-left: 24px;
  }
  .mk-excerpt{
    margin: 0.4rem 0 0.2rem 0;
  }
  .mk-raindrop-bookmark {
    width: 100%;
    margin: 0 0 1.3rem 0;
  }
  .mk-raindrop-tags{
    margin: 0.65rem 0 0 0;
  }
}
</style>

<!-- Base on raindrop.io's API filters, Add a Tab switch Group to view different tags,each tag is displayed only once in the this Tab switch. -->
<div class="mk-tab">
  <div class="mk-tab-tag" onclick="showAll()">All</div>
  {{ range $i, $item := index $json "items" }}
  {{ range $j, $tag := $item.tags }}
  <div class="mk-tab-tag" onclick="showTag('{{ $tag }}')">{{ $tag }}</div>
  {{ end }}
  {{ end }}
  <div class="mk-divider"></div>
</div>

<script>
  // 过滤掉上面mk-raindrop-tags"中重复的tag
  var tags = document.getElementsByClassName("mk-tab-tag");
  var tagList = [];
  for (var i = 0; i < tags.length; i++) {
    if (tagList.indexOf(tags[i].innerHTML) == -1) {
      tagList.push(tags[i].innerHTML);
    } else {
      tags[i].style.display = "none";
    }
  }

  function showAll() { var bookmarks = document.getElementsByClassName("mk-raindrop-bookmark"); for (var i = 0; i < bookmarks.length; i++) { bookmarks[i].style.display = "block"; } var tags = document.getElementsByClassName("mk-tab-tag"); for (var i = 0; i < tags.length; i++) { tags[i].classList.remove("mk-tab-tag-active"); } document.querySelector('.mk-tab-tag').classList.add('mk-tab-tag-active'); }

  function showTag(tag) { var bookmarks = document.getElementsByClassName("mk-raindrop-bookmark"); for (var i = 0; i < bookmarks.length; i++) { if (bookmarks[i].querySelectorAll('.mk-tag').length > 0) { var found = false; var bookmarkTags = bookmarks[i].querySelectorAll('.mk-tag'); for (var j = 0; j < bookmarkTags.length; j++) { if (bookmarkTags[j].innerHTML == tag) { found = true; break; } } if (found) { bookmarks[i].style.display = "block"; } else { bookmarks[i].style.display = "none"; } } else { bookmarks[i].style.display = "none"; } } var tags = document.getElementsByClassName("mk-tab-tag"); for (var i = 0; i < tags.length; i++) { if (tags[i].innerHTML == tag) { tags[i].classList.add("mk-tab-tag-active"); } else { tags[i].classList.remove("mk-tab-tag-active"); } } }

  document.querySelector('.mk-tab-tag:first-child').classList.add('mk-tab-tag-active');
  
</script>



<div class="mk-raindrop-bookmarks">
  
  {{ range $i, $item := index $json "items" }} {{ $domain := index (findRE
  "[^.]+\\.[^.]+$" (index (findRE "//[^/]+" $item.link) 0)) 0 }}
  <div class="mk-raindrop-bookmark">
    <a href="{{ $item.link }}" target="_blank" rel="noopener noreferrer">
      <div class="mk-title-wrapper">
        <div
          class="mk-avatar"
          style="background-image: url('https://unavatar.io/{{ trim $domain "/" }}')"
        ></div>
        <div class="mk-title">
          {{ $item.title }}
        </div>
        <div class="mk-svg">
          →
        </div>
      </div>
      {{ with $item.excerpt }}
      <div class="mk-excerpt">{{ . }}</div>
      {{ end }} {{ with $item.tags }}
      <div class="mk-raindrop-tags">
        {{ range . }}
        <div class="mk-tag">{{ . }}</div>
        {{ end }}
        <spacer></spacer>
        <!-- 增加一个div class="mk-important",从Raindrop API中获取important的值,如果是Boolean增显示<span>favorite</span> -->
        <div class="mk-important">
        {{ if eq $item.important true }}
        <svg width="20" height="20" viewBox="0 0 20 20" fill="var(--link-hover-color)" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M12.2858 3.9855H12.3191C12.6441 3.9855 12.9191 3.72716 12.9441 3.39383L13.0025 2.30216C13.0191 1.9605 12.7608 1.6605 12.4108 1.64383C12.0775 1.62716 11.7775 1.8855 11.7525 2.2355L11.6941 3.32716C11.6775 3.66884 11.9358 3.96883 12.2858 3.9855Z" fill="var(--link-hover-color)"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M14.6773 4.81955C14.8523 4.81955 15.0356 4.74455 15.1606 4.59455L15.8606 3.74455C16.0773 3.47789 16.0356 3.08622 15.769 2.86955C15.5023 2.64455 15.1106 2.68622 14.894 2.95289L14.194 3.80289C13.9773 4.06955 14.0106 4.46122 14.2773 4.67789C14.394 4.77789 14.5356 4.81955 14.6773 4.81955Z" fill="var(--link-hover-color)"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M17.6112 5.6109C17.4945 5.2859 17.1362 5.11923 16.8112 5.24423L15.7862 5.62757C15.4612 5.74423 15.2945 6.10257 15.4195 6.42757C15.5112 6.67757 15.7529 6.8359 16.0029 6.8359C16.0779 6.8359 16.1529 6.82757 16.2195 6.79423L17.2445 6.4109C17.5695 6.29423 17.7362 5.9359 17.6112 5.6109Z" fill="var(--link-hover-color)"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.11771 5.27328L5.32605 5.64828C5.53438 5.71495 5.72605 5.82328 5.88438 5.95662C5.95105 6.00662 6.00938 6.06495 6.06771 6.12328C6.39271 5.65662 6.91772 5.34828 7.50105 5.30662L6.93438 4.27328C6.86771 4.15662 6.77605 4.04828 6.67605 3.97328C6.56771 3.88162 6.45105 3.82328 6.31771 3.78162C6.17605 3.73995 6.04271 3.73162 5.90938 3.74828C5.64271 3.77328 5.38438 3.91495 5.21771 4.12328C5.13438 4.23162 5.06771 4.34828 5.03438 4.48995C4.99271 4.62328 4.97605 4.75662 4.99271 4.88995C5.00938 5.01495 5.05105 5.14828 5.11771 5.27328Z" fill="var(--link-hover-color)"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.21789 5.39828C8.65122 5.54828 9.03455 5.86495 9.25955 6.27328L10.4012 8.35658C10.6012 8.00662 10.8929 7.71495 11.2595 7.51495C11.3845 7.43995 11.5179 7.38995 11.6595 7.36495L9.83455 4.03162C9.70122 3.78995 9.47622 3.61495 9.21788 3.53162C8.68455 3.38162 8.09289 3.69828 7.92622 4.23995C7.85956 4.51495 7.88456 4.78995 8.01789 5.03162L8.21789 5.39828Z" fill="var(--link-hover-color)"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M13.876 5.87336C13.7927 5.71503 13.651 5.60669 13.476 5.55669C13.3094 5.49836 13.126 5.52336 12.9677 5.60669C12.326 5.95669 12.0677 6.73169 12.3677 7.38169C12.376 7.38169 12.3844 7.39003 12.3927 7.39003C12.7844 7.50669 13.1094 7.75669 13.301 8.11503L14.6427 10.565C15.026 11.29 15.251 12.065 15.3177 12.8483C15.4344 12.615 15.526 12.3733 15.601 12.1233C15.9844 10.8483 15.8427 9.49834 15.2177 8.31503L13.876 5.87336Z" fill="var(--link-hover-color)"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M12.5682 8.51541C12.4849 8.35708 12.3432 8.24041 12.1682 8.19041C12.1516 8.18208 12.1349 8.18208 12.1099 8.18208C12.0682 8.16541 12.0266 8.16541 11.9766 8.16541C11.8682 8.16541 11.7599 8.19041 11.6599 8.24875C10.9849 8.61541 10.7349 9.46541 11.1099 10.1404C11.1099 10.1487 11.1266 10.1737 11.1266 10.1821L11.8016 11.4237C11.8766 11.5654 11.8266 11.7404 11.6849 11.8154C11.6349 11.8487 11.5849 11.8571 11.5432 11.8571C11.4599 11.8571 11.3849 11.8237 11.3349 11.7654C11.3182 11.7571 11.3016 11.7321 11.2849 11.7071L9.67656 8.76541L8.52656 6.67375C8.40989 6.45708 8.21824 6.29041 7.99324 6.20708C7.96824 6.19041 7.94324 6.18208 7.90991 6.17375C7.86824 6.16541 7.82658 6.15708 7.78491 6.14875C7.73491 6.14041 7.68491 6.13208 7.63491 6.13208C7.60991 6.13208 7.58491 6.13208 7.55991 6.14041C7.49324 6.14875 7.43491 6.15708 7.36824 6.17375C7.33491 6.18208 7.30158 6.19875 7.26824 6.20708C7.23491 6.22375 7.19324 6.23208 7.15991 6.24875C7.10991 6.28208 7.05991 6.30708 7.01824 6.34041C6.83491 6.46541 6.69324 6.65708 6.61824 6.88208C6.55158 7.14875 6.57658 7.43208 6.70991 7.67375L8.52656 10.9904C8.60989 11.1321 8.55156 11.3154 8.40989 11.3904C8.36823 11.4154 8.32658 11.4237 8.27658 11.4237C8.21824 11.4237 8.15991 11.4071 8.11824 11.3821C8.09324 11.3737 8.06824 11.3571 8.05991 11.3321C8.04324 11.3154 8.02658 11.2987 8.00991 11.2737L7.34324 10.0487L5.62658 6.91541C5.55991 6.79875 5.46824 6.69041 5.36824 6.60708C5.25991 6.52375 5.14325 6.45708 5.00991 6.42375C4.86825 6.38208 4.73491 6.36541 4.60158 6.38208C4.33491 6.41541 4.07658 6.55708 3.90991 6.76541C3.82658 6.86541 3.75991 6.99041 3.72658 7.12375C3.68491 7.25708 3.66825 7.39875 3.68491 7.53208C3.68491 7.54875 3.69325 7.57375 3.70158 7.59041C3.71825 7.69875 3.75158 7.80708 3.80991 7.90708L6.19324 12.2737C6.26824 12.3987 6.23491 12.5571 6.11824 12.6321C6.10991 12.6487 6.09324 12.6571 6.07658 12.6654C6.03491 12.6904 5.99324 12.7071 5.94324 12.7071C5.83491 12.7071 5.73491 12.6487 5.67658 12.5571L4.28491 10.0071C4.10158 9.67375 3.72658 9.47375 3.35158 9.47375C3.19325 9.47375 3.02658 9.51541 2.88491 9.59041C2.39325 9.85708 2.20158 10.5154 2.46825 10.9987L5.09325 15.7987C5.75158 16.9571 6.80991 17.7987 8.09325 18.1654C8.20991 18.1987 8.32658 18.2237 8.43489 18.2487C8.66823 18.2987 8.90156 18.3321 9.1349 18.3487C9.25156 18.3487 9.36823 18.3571 9.48489 18.3571C10.3182 18.3571 11.1432 18.1487 11.8932 17.7404C13.0599 17.0987 13.9099 16.0487 14.2932 14.7654C14.3516 14.5571 14.4016 14.3571 14.4349 14.1487C14.6182 13.0654 14.4349 11.9487 13.9099 10.9571L12.5682 8.51541Z" fill="var(--link-hover-color)"/>
</svg>

</span> <span class="mk-important-description">很赞</span>
        {{ end }}
        {{ if eq $item.important false }}
        <div></div>
        {{ end }}
        </div>

        <div class="mk-tag mk-update-time">{{ $item.lastUpdate }}</div>
      </div>        

      {{ end }}
    </a>
      {{ if lt $i (sub (len (index $json "items")) 1) }}
  <div class="mk-divider"></div>
  </div>
  {{ end }} {{ end }}
</div>

<!-- 先将lastUpdate的时间格式化,再显示为相对时间,参考lately.mini.js -->
<script>
        var lastUpdate = document.getElementsByClassName("mk-update-time");
        for (var i = 0; i < lastUpdate.length; i++) {
          var time = lastUpdate[i].innerHTML;
          var date = new Date(time);
          var now = new Date();
          var diff = now.getTime() - date.getTime();
          var days = Math.floor(diff / (24 * 3600 * 1000));
          var leave1 = diff % (24 * 3600 * 1000);
          var hours = Math.floor(leave1 / (3600 * 1000));
          var leave2 = leave1 % (3600 * 1000);
          var minutes = Math.floor(leave2 / (60 * 1000));
          var leave3 = leave2 % (60 * 1000);
          var seconds = Math.round(leave3 / 1000);
          if (days > 0) {
            lastUpdate[i].innerHTML = days + " 天前";
          } else if (hours > 0) {
            lastUpdate[i].innerHTML = hours + " 小时前";
          } else if (minutes > 0) {
            lastUpdate[i].innerHTML = minutes + " 分钟前";
          } else if (seconds > 0) {
            lastUpdate[i].innerHTML = seconds + " 秒前";
          }
          // 增加月前和年前的定义
          var months = Math.floor(days / 30);
          var years = Math.floor(days / 365);
          if (months > 0) {
            lastUpdate[i].innerHTML = months + " 月前";
          } else if (years > 0) {
            lastUpdate[i].innerHTML = years + " 年前";
          }
        }
</script> 