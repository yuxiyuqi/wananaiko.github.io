<style>
  /* 页面初始化 */
  div#page {
    background: none;
    border: 0;
    padding: 0;
  }
  [data-theme="dark"] #twikoo .tk-content,
  #twikoo .tk-content {
    padding: 0;
    background: transparent;
  }

  .tk-comments-container > .tk-comment,
  .tk-submit:nth-child(1) {
    background: var(--card-bg);
    border: 1px rgba(188, 188, 188, 0.8) solid;
    box-shadow: 0 5px 10px rgb(189 189 189 / 10%);
    transition: all 0.3s ease-in-out;
    border-radius: 12px;
  }

  .tk-comments-container > .tk-comment:hover,
  .tk-submit:nth-child(1):hover {
    border-color: #6dc3fd;
  }

  .tk-submit {
    padding: 20px 10px 0;
  }

  .tk-comments-container > .tk-comment {
    padding: 15px;
  }

  /* 页面初始化结束 */
  div#todolist {
    display: flex;
    flex-wrap: wrap;
    margin-top: 2rem;
  }
  .list_item {
    display: inline-block;
    width: calc(50% - 0.4rem);
    background: var(--code-bg);
    border-radius: var(--radius);
    padding: 10px 1rem 1.2rem;
    border: 1px solid var(--border);
    margin-right: 1rem;
    margin-bottom: 1rem;
  }
  .list_item li {
    margin: 0 !important;
    border-bottom: 0.5px solid var(--tertiary-bg);
  }
  .list_item li::marker {
    content: none;
  }
  @media screen and (max-width: 900px) {
    div#todolist {
      margin: 1rem 5px 0;
    }
  }
  @media screen and (max-width: 768px) {
    .list_item {
      width: 100%;
    }
  }

  /* 新样式 */
  .todo-title {
    font-size: 18px;
    line-height: 1.6;
    font-weight: 500;
    background-repeat: no-repeat;
    background-position: left center;
    background-size: 16px;
    color: var(--content);
    padding-bottom: 0.5rem;
  }

  li.done {
    text-decoration: line-through;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0.5rem 0;
    opacity: 0.8;
    text-decoration: line-through;
  }

  li.undo {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0.5rem 0;
  }

  .icon-undo {
    display: flex;
    margin-right: 0.5rem;
  }

  .icon-done {
    display: flex;
    margin-right: 0.5rem;
  }

  svg {
    width: 20px;
    height: 20px;
  }

  .undo-content {
    font-size: 14px;
    line-height: 1.6;
    color: var(--content);
  }

  .done-content {
    font-size: 14px;
    line-height: 1.6;
    color: var(--secondary);
    text-decoration-line: line-through;
  }

  .todo-head {
    display: flex;
    align-items: center;
    border-bottom: 0.5px solid var(--tertiary-bg);
    justify-content: space-between;
  }

  .todo-icon-right {
    transform: translateX(8px) translateY(-24px) rotate(-20deg) scale(1)
      skew(1deg);
    -webkit-transform: translateX(8px) translateY(-24px) rotate(-20deg) scale(1)
      skew(1deg);
    -moz-transform: translateX(8px) translateY(-24px) rotate(-20deg) scale(1)
      skew(1deg);
  }
</style>

<script src="https://cdn.staticfile.org/font-awesome/6.1.1/css/all.min.css"></script>
<script src="/js/waterfall.js"></script>

<div id="todolist"></div>

<script>
  // 瀑布流函数，不用管
  function waterfall(t) {
    function e(t, e) {
      var n = window.getComputedStyle(e);
      return parseFloat(n["margin" + t]) || 0;
    }
    function n(t) {
      return t + "px";
    }
    function r(t) {
      return parseFloat(t.style.left);
    }
    function o(t) {
      return t.clientWidth;
    }
    function l(t) {
      return (
        (function (t) {
          return parseFloat(t.style.top);
        })(t) +
        (function (t) {
          return t.clientHeight;
        })(t) +
        e("Bottom", t)
      );
    }
    function i(t) {
      return r(t) + o(t) + e("Right", t);
    }
    function u(t) {
      t = t.sort(function (t, e) {
        return l(t) === l(e) ? r(e) - r(t) : l(e) - l(t);
      });
    }
    function a(e) {
      o(t) != h &&
        (e.target.removeEventListener(e.type, arguments.callee), waterfall(t));
    }
    "string" == typeof t && (t = document.querySelector(t));
    var s = [].map.call(t.children, function (t) {
      return (t.style.position = "absolute"), t;
    });
    t.style.position = "relative";
    var f = [];
    s.length &&
      ((s[0].style.top = "0px"),
      (s[0].style.left = n(e("Left", s[0]))),
      f.push(s[0]));
    for (var p = 1; p < s.length; p++) {
      var c = s[p - 1],
        y = s[p];
      if (!(i(c) + o(y) <= o(t))) break;
      (y.style.top = c.style.top),
        (y.style.left = n(i(c) + e("Left", y))),
        f.push(y);
    }
    for (; p < s.length; p++) {
      u(f);
      y = s[p];
      var d = f.pop();
      (y.style.top = n(l(d) + e("Top", y))),
        (y.style.left = n(r(d))),
        f.push(y);
    }
    u(f);
    var v = f[0];
    t.style.height = n(l(v));
    var h = o(t);
    window.addEventListener
      ? window.addEventListener("resize", a)
      : (document.body.onresize = a);
  }

  // 清单函数
  todolist();
  function todolist() {
    fetch("https://memo.wananaiko.com/api/memo?creatorId=1&tag=清单")
      .then((res) => res.json())
      .then((data) => {
        // 注意替换链接和ID
        // 获取并处理数据
        data = data.data;
        let box = document.getElementById("todolist");
        data.forEach((item) => {
          // 处理数据
          let content = item.content,
            title = content.match(/\[(.*?)\]/g)[0].replace(/\[(.*?)\]/, "$1");
          // 去掉多余内容，替换清单内容
          content = content
            .replace(/#.*\s/g, "")
            .replace(
              /(-\s\[\s\]\s)(.*)/g,
              `<li class="undo"><div class="icon-undo"><?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="var(--content)"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" stroke="var(--content)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><div class="undo-content">$2</div></li>`
            )
            .replace(
              /(-\s\[x\]\s)(.*)/g,
              `<li class="done">
                  <div class="icon-done"><?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="var(--secondary)"><path d="M7 12.5l3 3 7-7" stroke="var(--secondary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" stroke="var(--secondary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                  </div><div class="done-content">$2</div>
                </li>`
            );
          // 渲染数据
          let div = document.createElement("div");
          div.className = "list_item";
          div.innerHTML = `<div class="todo-head"><div class="todo-title">${title}</div><div class="todo-icon-right"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.95711 15.0429C9.34763 15.4334 9.34763 16.0666 8.95711 16.4571L3.95711 21.4571C3.56658 21.8476 2.93342 21.8476 2.54289 21.4571C2.15237 21.0666 2.15237 20.4334 2.54289 20.0429L7.54289 15.0429C7.93342 14.6524 8.56658 14.6524 8.95711 15.0429Z" fill="var(--link-hover-color)"/>
<path d="M17.7093 2.55346C19.4569 3.18528 20.8147 4.54305 21.4465 6.29064C21.5536 6.58633 21.6798 6.93507 21.7258 7.24165C21.7801 7.60384 21.744 7.94519 21.608 8.32365C21.3168 9.13408 20.6643 9.49626 19.9452 9.89542L18.5273 10.6861C18.0145 10.9721 17.676 11.1618 17.4348 11.3286C17.2 11.4909 17.1333 11.582 17.1056 11.6358C17.0909 11.6641 17.0453 11.8022 17.0573 12.2506C17.0686 12.6742 17.1236 13.2487 17.2024 14.0663C17.3296 15.3845 17.1109 16.6904 16.3502 17.9068C16.2218 18.1123 16.0604 18.3708 15.88 18.563C15.6669 18.7901 15.4215 18.9506 15.1053 19.0787C14.7835 19.2091 14.4907 19.2619 14.1748 19.2478C13.906 19.2358 13.5974 19.1656 13.3398 19.107C11.3641 18.6584 9.47833 17.5121 7.98305 16.0169C6.48778 14.5216 5.34151 12.6359 4.89294 10.6602C4.83436 10.4027 4.76418 10.0941 4.75221 9.82535C4.73813 9.50941 4.79103 9.21658 4.92151 8.89474C5.04969 8.5786 5.21026 8.3331 5.43747 8.12006C5.62978 7.93974 5.88832 7.7784 6.09379 7.65019C7.29324 6.90084 8.58854 6.66967 9.89679 6.78538C10.7321 6.85926 11.321 6.91095 11.754 6.91998C11.968 6.92445 12.2391 6.94301 12.3803 6.86947C12.4326 6.84219 12.5235 6.7753 12.6865 6.53889C12.8534 6.29676 13.0438 5.95698 13.3302 5.44342L14.1046 4.05478C14.5037 3.33567 14.8659 2.68318 15.6763 2.39201C16.0548 2.25603 16.3961 2.2199 16.7583 2.27422C17.0649 2.32019 17.4136 2.44643 17.7093 2.55346Z" fill="var(--link-hover-color)"/>
</svg>
</div></div><div class="todo-container">${content}</div>`;
          box.appendChild(div);
        });
        waterfall("#todolist");
      })
      .catch();
  }
</script>
