<style>
  /* 页面初始化 */
  div#page {
    background: none;
    border: 0;
    padding: 0;
  }
  [data-theme="dark"] #twikoo .tk-content,
  #twikoo .tk-content {
    padding: 0;
    background: transparent;
  }

  .tk-comments-container > .tk-comment,
  .tk-submit:nth-child(1) {
    background: var(--card-bg);
    border: 1px rgba(188, 188, 188, 0.8) solid;
    box-shadow: 0 5px 10px rgb(189 189 189 / 10%);
    transition: all 0.3s ease-in-out;
    border-radius: 12px;
  }

  .tk-comments-container > .tk-comment:hover,
  .tk-submit:nth-child(1):hover {
    border-color: #6dc3fd;
  }

  .tk-submit {
    padding: 20px 10px 0;
  }

  .tk-comments-container > .tk-comment {
    padding: 15px;
  }

  /* 页面初始化结束 */
  div#todolist {
    display: flex;
    flex-wrap: wrap;
    margin-top: 1rem;
  }
  .list_item {
    display: inline-block;
    width: calc(50% - 0.4rem);
    background: var(--code-bg);
    border-radius: 12px;
    padding: 10px 1rem 1.2rem;
    border: 1px solid var(--border);
    margin-right: 1rem;
    margin-bottom: 1rem;
  }
  .list_item h3 {
    margin: 0;
    border-bottom: var(--todo-border);
  }
  .list_item ul {
    font-size: 17px;
    padding: 0 !important;
    margin: 0;
  }
  .list_item li {
    margin: 0 !important;
    border-bottom: 0.5px solid var(--tertiary-bg);
  }
  .list_item li::marker {
    content: none;
  }
  li.done {
    opacity: 0.8;
    text-decoration: line-through;
  }
  @media screen and (max-width: 900px) {
    div#todolist {
      margin: 1rem 5px 0;
    }
  }
  @media screen and (max-width: 768px) {
    .list_item {
      width: 100%;
    }
  }

  /* 新样式 */
  .todo-title {
    font-size: 18px;
    line-height: 1.6;
    font-weight: 500;
    background-repeat: no-repeat;
    background-position: left center;
    background-size: 16px;
    color: var(--content);
    border-bottom: 0.5px solid var(--tertiary-bg);
    padding-bottom: 0.5rem;
  }

  li.done {
    text-decoration: line-through;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0.5rem 0;
  }

  li.undo {
    text-decoration: line-through;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0.5rem 0;
  }

  .icon-undo {
    display: flex;
    margin-right: 0.5rem;
  }

  .icon-done {
    display: flex;
    margin-right: 0.5rem;
  }

  svg {
    width: 20px;
    height: 20px;
  }

  .undo-content {
    font-size: 14px;
    line-height: 1.6;
    color: var(--content);
  }

  .done-content {
    font-size: 14px;
    line-height: 1.6;
    color: var(--secondary);
    text-decoration-line: line-through;
  }
</style>

<script src="https://cdn.staticfile.org/font-awesome/6.1.1/css/all.min.css"></script>
<script src="/js/waterfall.js"></script>

<div id="todolist"></div>

<script>
  // 瀑布流函数，不用管
  function waterfall(t) {
    function e(t, e) {
      var n = window.getComputedStyle(e);
      return parseFloat(n["margin" + t]) || 0;
    }
    function n(t) {
      return t + "px";
    }
    function r(t) {
      return parseFloat(t.style.left);
    }
    function o(t) {
      return t.clientWidth;
    }
    function l(t) {
      return (
        (function (t) {
          return parseFloat(t.style.top);
        })(t) +
        (function (t) {
          return t.clientHeight;
        })(t) +
        e("Bottom", t)
      );
    }
    function i(t) {
      return r(t) + o(t) + e("Right", t);
    }
    function u(t) {
      t = t.sort(function (t, e) {
        return l(t) === l(e) ? r(e) - r(t) : l(e) - l(t);
      });
    }
    function a(e) {
      o(t) != h &&
        (e.target.removeEventListener(e.type, arguments.callee), waterfall(t));
    }
    "string" == typeof t && (t = document.querySelector(t));
    var s = [].map.call(t.children, function (t) {
      return (t.style.position = "absolute"), t;
    });
    t.style.position = "relative";
    var f = [];
    s.length &&
      ((s[0].style.top = "0px"),
      (s[0].style.left = n(e("Left", s[0]))),
      f.push(s[0]));
    for (var p = 1; p < s.length; p++) {
      var c = s[p - 1],
        y = s[p];
      if (!(i(c) + o(y) <= o(t))) break;
      (y.style.top = c.style.top),
        (y.style.left = n(i(c) + e("Left", y))),
        f.push(y);
    }
    for (; p < s.length; p++) {
      u(f);
      y = s[p];
      var d = f.pop();
      (y.style.top = n(l(d) + e("Top", y))),
        (y.style.left = n(r(d))),
        f.push(y);
    }
    u(f);
    var v = f[0];
    t.style.height = n(l(v));
    var h = o(t);
    window.addEventListener
      ? window.addEventListener("resize", a)
      : (document.body.onresize = a);
  }

  // 清单函数
  todolist();
  function todolist() {
    fetch("https://memo.wananaiko.com/api/memo?creatorId=1&tag=清单")
      .then((res) => res.json())
      .then((data) => {
        // 注意替换链接和ID
        // 获取并处理数据
        data = data.data;
        let box = document.getElementById("todolist");
        data.forEach((item) => {
          // 处理数据
          let content = item.content,
            title = content.match(/\[(.*?)\]/g)[0].replace(/\[(.*?)\]/, "$1");
          // 去掉多余内容，替换清单内容
          content = content
            .replace(/#.*\s/g, "")
            .replace(
              /(-\s\[\s\]\s)(.*)/g,
              `<li class="undo"><div class="icon-undo"><?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="var(--content)"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" stroke="var(--content)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><div class="undo-content">$2</div></li>`
            )
            .replace(
              /(-\s\[x\]\s)(.*)/g,
              `<li class="done">
                  <div class="icon-done"><?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="var(--secondary)"><path d="M7 12.5l3 3 7-7" stroke="var(--secondary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" stroke="var(--secondary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                  </div><div class="done-content">$2</div>
                </li>`
            );
          // 渲染数据
          let div = document.createElement("div");
          div.className = "list_item";
          div.innerHTML = `<div class="todo-title">${title}</div><div class="todo-container">${content}</div>`;
          box.appendChild(div);
        });
        waterfall("#todolist");
      })
      .catch();
  }
</script>
